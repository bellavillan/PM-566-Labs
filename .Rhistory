geom_jitter(mapping = aes(x = met$wind.sp, y = met$dew.point, color = region))+
geom_smooth(mapping = aes(x = met$wind.sp, y = met$dew.point, linetype = region))
met[!is.na(region)] |>
ggplot() +
geom_jitter(mapping = aes(x = met$wind.sp, y = met$dew.point, color = region))+
geom_smooth(mapping = aes(x = met$wind.sp, y = met$dew.point, linetype = region))
met[!is.na(region)] |>
ggplot() +
geom_jitter(mapping = aes(x = met$wind.sp, y = met$dew.point, color = met$region))+
geom_smooth(mapping = aes(x = met$wind.sp, y = met$dew.point, linetype = met$region))
met[!is.na(region)] |>
ggplot() +
geom_jitter(mapping = aes(x = met$wind.sp, y = met$dew.point, color = 'region'))+
geom_smooth(mapping = aes(x = met$wind.sp, y = met$dew.point, linetype = 'region'))
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_point(mapping = aes(x = dew.point, y = wind.sp, color = region))
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_point(mapping = aes(x = dew.point, y = wind.sp, color = region))+
stat_smooth()
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_point(mapping = aes(x = dew.point, y = wind.sp, color = region))+
stat_smooth(method='lm', se=FALSE)
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_point(mapping = aes(x = dew.point, y = wind.sp, color = region))+
geom_smooth(wind.sp ~ dew.point)
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_point(mapping = aes(x = dew.point, y = wind.sp, color = region))
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_jitter(mapping = aes(x = dew.point, y = wind.sp, color = region))
library(tidyverse)
ggplot(combined_data, aes(x = dew.point, y = wind.sp, color = region)) +
geom_jitter(alpha = 0.5, width = 0.2, height = 0.2) +
stat_smooth(method = "lm", se = TRUE) +
labs(title = "Association Between Dew Point and Wind Speed by Region",
x = "Dew Point (°F or °C)",
y = "Wind Speed (mph or km/h)",
color = "Region") +
theme_minimal())
library(tidyverse)
ggplot(combined_data, aes(x = dew.point, y = wind.sp, color = region)) +
geom_jitter(alpha = 0.5, width = 0.2, height = 0.2) +
stat_smooth(method = "lm", se = TRUE) +
labs(title = "Association Between Dew Point and Wind Speed by Region",
x = "Dew Point (°F or °C)",
y = "Wind Speed (mph or km/h)",
color = "Region") +
theme_minimal()
library(tidyverse)
ggplot(combined_data, aes(x = dew.point, y = wind.sp, color = region)) +
geom_jitter(alpha = 0.5, width = 0.2, height = 0.2) +
stat_smooth(method = "lm", se = TRUE) +
labs(title = "Association Between Dew Point and Wind Speed by Region",
x = "Dew Point (°F or °C)",
y = "Wind Speed (mph or km/h)",
color = "Region") +
theme_minimal()
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_jitter(mapping = aes(x = dew.point, y = wind.sp, color = region))
geom_smooth(mapping = aes(x = dew.point, y = wind.sp, linetype = region))
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_jitter(mapping = aes(x = dew.point, y = wind.sp, color = region)) +
geom_smooth(mapping = aes(x = dew.point, y = wind.sp, linetype = region))
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_jitter(mapping = aes(x = dew.point, y = wind.sp, color = region)) +
geom_smooth(mapping = aes(x = dew.point, y = wind.sp, linetype = region))+
labs(title = "Association of Dew Point and Wind Speed by Region")
library(tidyverse)
met <- met[!is.na(met$dew.point), ]
ggplot(met, aes(x = 1, y = dew.point)) +
geom_violin(fill = "lightblue") +
facet_wrap(~ region, nrow = 1)
x = "Region",
library(tidyverse)
met <- met[!is.na(met$dew.point), ]
ggplot(met, aes(x = 1, y = dew.point)) +
geom_violin(fill = "lightblue") +
facet_wrap(~ region, nrow = 1)
labs(title = "Dew Point by Region"),
library(tidyverse)
met <- met[!is.na(met$dew.point), ]
ggplot(met, aes(x = 1, y = dew.point)) +
geom_violin(fill = "lightblue") +
facet_wrap(~ region, nrow = 1)
labs(title = "Dew Point by Region",
x = "Region",
y = "Dew Point") +
theme_minimal() +
library(tidyverse)
met <- met[!is.na(met$dew.point), ]
ggplot(met, aes(x = 1, y = dew.point)) +
geom_violin(fill = "lightblue") +
facet_wrap(~ region, nrow = 1)
labs(title = "Dew Point by Region",
x = "Region",
y = "Dew Point") +
theme_minimal()
met[!is.na(elev_cat) != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
met[!is.na(elev_cat) != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = met$elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
if (!file.exists("met_all.gz"))
download.file(
url = "https://raw.githubusercontent.com/USCbiostats/data-science-data/master/02_met/met_all.gz",
destfile = "met_all.gz",
method   = "libcurl",
timeout  = 60
)
met <- data.table::fread("met_all.gz")
met <- as.data.frame(met)
met <- met[met$temp > -17,]
met$elev[met$elev == 9999.0] <- NA
met$Date <- as.Date(paste(met$year, met$month, met$day, sep = "-"))
library(lubridate)
met$Week <- week(met$Date)
met <- met[met$Week == 31,]
library(dplyr)
met_daily <- summarize(met,
temp = mean(temp),
lat = mean(lat),
lon = mean(lon),
elev = mean(elev),
rh = mean(rh),
wind.sp = mean(wind.sp),
vis.dist = mean(vis.dist),
dew.point = mean(dew.point),
.by = c(USAFID))
met$region <- ifelse(met$lon < -98.00 & met$lat > 39.71, "NW",
ifelse(met$lon < -98.00 & met$lat <= 39.71, "SW",
ifelse(met$lon >= -98.00 & met$lat > 39.71, "NE",
ifelse(met$lon >= -98.00 & met$lat <= 39.71, "SE",
NA))))
met$elev_cat <-ifelse(met$elev > 252, "high", "low")
library(tidyverse)
met <- met[!is.na(met$wind.sp), ]
ggplot(met, aes(x = 1, y = wind.sp)) +
geom_violin(fill = "pink") +
facet_wrap(~ region, nrow = 1)
labs(title = "Wind Speed by Region",
x = "Region",
y = "Wind Speed") +
theme_minimal()
library(tidyverse)
met <- met[!is.na(met$dew.point), ]
ggplot(met, aes(x = 1, y = dew.point)) +
geom_violin(fill = "lightblue") +
facet_wrap(~ region, nrow = 1)
labs(title = "Dew Point by Region",
x = "Region",
y = "Dew Point") +
theme_minimal()
library(tidyverse)
met <- met[!is.na(met$region), ]
ggplot(data = met) +
geom_jitter(mapping = aes(x = dew.point, y = wind.sp, color = region)) +
geom_smooth(mapping = aes(x = dew.point, y = wind.sp, linetype = region))+
labs(title = "Association of Dew Point and Wind Speed by Region")
met$elev_cat
met[!is.na(elev_cat) != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
met$elev_cat
met[!is.na(elev_cat) != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = 'elev_cat', fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
ggplot(met_avg) +
ggplot(met[!is.na(elev_cat) != "clear"])
met$elev_cat
met[!is.na(elev_cat) != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = `elev_cat`, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
ggplot() +
geom_bar(mapping = aes(x = `elev_cat`, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met$elev_cat <-ifelse(met$elev > 252, "high", "low")
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
ggplot() +
geom_bar(mapping = aes(x = wind.sp, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met <- met[!is.na(met$elev_cat) & met$elev_cat != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met <- met[!is.na(met$elev_cat) & elev_cat != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met <- met[!is.na(met$elev_cat) & met$elev_cat != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met[!is.na(met$elev_cat) & met$elev_cat != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met[!is.na(met$elev_cat) & met$elev_cat != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
colnames(met)
library(dplyr)
met_avg <- summarize(met,
temp = mean(temp),
lat = mean(lat),
lon = mean(lon),
elev = mean(elev),
rh = mean(rh),
wind.sp = mean(wind.sp),
vis.dist = mean(vis.dist),
dew.point = mean(dew.point),
.by = c(USAFID))
l <- met_avg[!is.na(dew.point) & dew.point != "clear",] |>
ggplot(met_avg, aes(x = Region, y = `Dew Point`, fill = Region)) +
stat_summary(fun.data = "mean_sdl", geom = "bar", width = 0.7, position = position_dodge(0.8)) +
stat_summary(fun.data = "mean_sdl", geom = "errorbar", width = 0.2, position = position_dodge(0.8)) +
labs(title = "Mean Dew Point by Region with Standard Deviation Error Bars",
x = "Region",
y = "Mean Dew Point (°F or °C)") +
theme_minimal()
combined_data <- combined_data %>%
mutate(LA_site = ifelse(`Local Site Name` == "Los Angeles-North Main Street", `Local Site Name`, NA))
library(dplyr)
combined_data <- combined_data %>%
mutate(LA_site = ifelse(`Local Site Name` == "Los Angeles-North Main Street", `Local Site Name`, NA))
LA_site <- combined_data[!is.na(combined_data$LA_site), ]
combined_data[!is.na("LA_site")] |>
ggplot() +
geom_point(mapping = aes(x = Date, y = Daily_PM2.5, color= "LA_site"), color = "lightblue") +
facet_wrap(~ "LA_site", nrow = 1, scales = "free")+
labs(title = "Daily PM2.5 Concentration for Los Angeles-North Main Street Station, 2002 vs. 2022")+
labs(x = expression("Date"), y = "Daily PM2.5 Concentration (µg/m^3)")
library(dplyr)
combined_data <- combined_data %>%
mutate(LA_site = ifelse(`Local Site Name` == "Los Angeles-North Main Street", `Local Site Name`, NA))
LA_site <- combined_data[!is.na(combined_data$LA_site), ]
library(tidyverse)
combined_data[!is.na("LA_site")] |>
ggplot() +
geom_point(mapping = aes(x = Date, y = Daily_PM2.5, color= "LA_site"), color = "lightblue") +
facet_wrap(~ "LA_site", nrow = 1, scales = "free")+
labs(title = "Daily PM2.5 Concentration for Los Angeles-North Main Street Station, 2002 vs. 2022")+
labs(x = expression("Date"), y = "Daily PM2.5 Concentration (µg/m^3)")
library(dplyr)
combined_data <- combined_data %>%
mutate(LA_site = ifelse(`Local Site Name` == "Los Angeles-North Main Street", `Local Site Name`, NA))
LA_site <- combined_data[!is.na(combined_data$LA_site), ]
library(tidyverse)
combined_data[!is.na("LA_site")] |>
ggplot() +
geom_point(mapping = aes(x = Date, y = `Daily Mean PM2.5 Concentration`, color= "LA_site"), color = "lightblue") +
facet_wrap(~ "LA_site", nrow = 1, scales = "free")+
labs(title = "Daily PM2.5 Concentration for Los Angeles-North Main Street Station, 2002 vs. 2022")+
labs(x = expression("Date"), y = "Daily PM2.5 Concentration (µg/m^3)")
library(dplyr)
combined_data <- combined_data %>%
mutate(LA_site = ifelse(`Local Site Name` == "Los Angeles-North Main Street", `Local Site Name`, NA))
LA_site <- combined_data[!is.na(combined_data$LA_site), ]
library(tidyverse)
combined_data[!is.na("LA_site")] |>
ggplot() +
geom_point(mapping = aes(x = Year, y = `Daily Mean PM2.5 Concentration`, color= "LA_site"), color = "lightblue") +
facet_wrap(~ "LA_site", nrow = 1, scales = "free")+
labs(title = "Daily PM2.5 Concentration for Los Angeles-North Main Street Station, 2002 vs. 2022")+
labs(x = expression("Date"), y = "Daily PM2.5 Concentration (µg/m^3)")
library(tidyverse)
met <- met[!is.na(met$region),]
met <-
met[!is.na(met$elev_cat) & met$elev_cat != "clear"] |>
ggplot() +
geom_bar(mapping = aes(x = elev_cat, fill = region), position = "dodge")+
scale_fill_brewer(palette = "Pastel1")+
labs(title = "Weather Station Regions by Elevation Category")
library(tidyverse)
met <- met[!is.na(met$region),]
met <- met[!is.na(met$elev_cat,]
library(tidyverse)
met <- met[!is.na(met$region),]
met <- met[!is.na(met$elev_cat),]
ggplot(met, aes(x = met$elev_cat, fill = met$region))+
geom_bar(position = "dodge") + scale_fill_brewer(palette = "Pastel1") +
labs(title = "Weather Station Regions by Elevation Category",
x = "Elevation Category",
y = "Number of Stations",
fill = "region") +
theme_minimal()
met <- met[!is.na(met$region),]
met <- met[!is.na(met$dew.point),]
met <- met[!is.na(met$wind.sp),]
l <- met[!is.na(met$region),] |>
ggplot() +
stat_summary(mapping = aes(x = met$region, y = dew.point),
fun.min = min,
fun.max = max,
fun = median,
fun.data = mean_sdl)
l
install.packages("Hmisc")
### 7. Make a map showing the spatial trend in relative humidity in the US
met <- met[!is.na(met$region),]
met <- met[!is.na(met$dew.point),]
met <- met[!is.na(met$wind.sp),]
l <- met[!is.na(met$region),] |>
ggplot() +
stat_summary(mapping = aes(x = region, y = dew.point),
fun.min = min,
fun.max = max,
fun = median,
fun.data = mean_sdl)
l
labs(title = "Mean Dew Point by Region with Standard Deviation Error Bars",
x = "Region",
y = "Mean Dew Point (°C)") +
theme_minimal()
summarize(met,
wind.sp = median(wind.sp))
met <- met[!is.na(met$region),]
met <- met[!is.na(met$dew.point),]
met <- met[!is.na(met$wind.sp),]
l <- met[!is.na(met$region),] |>
ggplot() +
stat_summary(mapping = aes(x = region, y = dew.point),
fun.min = min,
fun.max = max,
fun = median,
fun.data = mean_sdl)
l
labs(title = "Mean Dew Point by Region with Standard Deviation Error Bars",
x = "Region",
y = "Mean Dew Point (°C)") +
theme_minimal()
summarize(met,
dew.point = median(dew.point))
met <- met[!is.na(met$region),]
met <- met[!is.na(met$dew.point),]
met <- met[!is.na(met$wind.sp),]
l <- met[!is.na(met$region),] |>
ggplot() +
stat_summary(mapping = aes(x = region, y = wind.sp),
fun.min = min,
fun.max = max,
fun = median,
fun.data = mean_sdl)
l
labs(title = "Mean Wind Speed by Region with Standard Deviation Error Bars",
x = "Region",
y = "Mean Wind Speed") +
theme_minimal()
summarize(met,
wind.sp = median(wind.sp))
met <- met[!is.na(met$region),]
met <- met[!is.na(met$dew.point),]
met <- met[!is.na(met$wind.sp),]
l <- met[!is.na(met$region),] |>
ggplot() +
stat_summary(mapping = aes(x = region, y = dew.point),
fun.min = min,
fun.max = max,
fun = median,
fun.data = mean_sdl)
l
labs(title = "Mean Dew Point by Region with Standard Deviation Error Bars",
x = "Region",
y = "Mean Dew Point (°C)") +
theme_minimal()
summarize(met,
dew.point = mean(dew.point))
met <- met[!is.na(met$region),]
met <- met[!is.na(met$dew.point),]
met <- met[!is.na(met$wind.sp),]
l <- met[!is.na(met$region),] |>
ggplot() +
stat_summary(mapping = aes(x = region, y = wind.sp),
fun.min = min,
fun.max = max,
fun = median,
fun.data = mean_sdl)
l
labs(title = "Mean Wind Speed by Region with Standard Deviation Error Bars",
x = "Region",
y = "Mean Wind Speed") +
theme_minimal()
summarize(met,
wind.sp = median(wind.sp))
met <- met[!is.na(met$rh),]
library(leaflet)
met_avg2 <- met[,.(rh = mean(rh, na.rm=TRUE), lat = mean(lat), lon = mean(lon)), by=c("USAFID")]
met <- met[!is.na(met$rh),]
library(leaflet)
met_avg2 <- met[,.(rh = mean(rh, na.rm=TRUE), lat = mean(lat), lon = mean(lon)), by=c("USAFID")]
setwd("~/Documents")
setwd("~/GitHub")
dir.create("PM-566-Labs")
setwd("PM-566-Labs")
download.file(
"https://raw.githubusercontent.com/USCbiostats/PM566/master/website/content/assignment/05-lab.Rmd",
destfile = "README.Rmd"
)
View(combined_data)
library(data.table)
library(dplyr)
met_url <- "https://github.com/USCbiostats/data-science-data/raw/master/02_met/met_all.gz"
tmp <- "met.gz"
dat <- fread(tmp)
met_url <- "https://github.com/USCbiostats/data-science-data/raw/master/02_met/met_all.gz"
tmp <- "met_all.gz"
dat <- fread(tmp)
head(dat)
dat <- as.data.frame(dat)
View(dat)
stations <- fread("https://noaa-isd-pds.s3.amazonaws.com/isd-history.csv")
stations <- as.data.frame(stations)
stations$USAF <- as.integer(stations$USAF)
stations$USAF[stations$USAF == 999999] <- NA
stations$CTRY[stations$CTRY == ""] <- NA
stations$STATE[stations$STATE == ""] <- NA
stations <- fread("https://noaa-isd-pds.s3.amazonaws.com/isd-history.csv")
stations <- as.data.frame(stations)
stations$USAF <- as.integer(stations$USAF)
stations <- fread("https://noaa-isd-pds.s3.amazonaws.com/isd-history.csv")
stations <- as.data.frame(stations)
stations$USAF <- as.integer(stations$USAF)
stations
merge(
x     = dat,
y     = stations,
by.x  = "USAFID",
by.y  = "USAF",
all.x = TRUE,
all.y = FALSE
) |> nrow()
)
merge(
x     = dat,
y     = stations,
by.x  = "USAFID",
by.y  = "USAF",
all.x = TRUE,
all.y = FALSE
)
head(dat[, c('USAFID', 'WBAN', 'STATE')], n = 4)
merge(
x     = dat,
y     = stations,
by.x  = "USAFID",
by.y  = "USAF",
all.x = TRUE,
all.y = FALSE
)
head(dat[, c("USAFID", "WBAN", "STATE")], n = 4)
merge(
x     = dat,
y     = stations,
by.x  = "USAFID",
by.y  = "USAF",
all.x = TRUE,
all.y = FALSE
)
